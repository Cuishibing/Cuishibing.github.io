<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="/css/common.css" rel="stylesheet" type="text/css" />
    <script src="/js/md5.min.js"></script>
    <script type="module">
        import { init } from "/js/include.js"
        init()
    </script>
</head>

<body>
    <include src="/header/s_header.html"></include>

    <h2 id="post_title"></h2>

    <div id="post_content" style="margin-top: 10px;margin-bottom:10px"></div>
    <div>
        <button id="post_edit_btn">编辑</button>
    </div>
    <script type="module">
        import { req } from "/js/req.js"

        let url = window.location.href
        let queryString = url.substr(url.indexOf("?") + 1)
        let queryParams = queryString.split("&")
        let target = ""
        let title = ""
        let category = ""
        queryParams.forEach(paramKV => {
            let keyAndValue = paramKV.split("=")
            if (keyAndValue[0] == "target") {
                target = keyAndValue[1]
            }
            if (keyAndValue[0] == "title") {
                title = keyAndValue[1]
            }
            if (keyAndValue[0] == "category") {
                category = keyAndValue[1]
            }
        })

        document.getElementById("post_title").innerText = decodeURI(title)

        function loadContent() {
            if (target && target != "") {
                req(target, "GET").then(data => {
                    document.getElementById("post_content")
                    post_content.innerHTML = data.message
                })
            }
        }
        loadContent()
        // edit_btn
        document.getElementById("post_edit_btn").onclick = editBtnOnclick
        function editBtnOnclick(e) {
            window.location.href = "/posteditor/posteditor.html?target=" + target + "&title=" + title + "&category=" + category
        }
    </script>

</body>

</html>